require "lib.util"

local Vulnerability = {}
Vulnerability.__index = Vulnerability
Vulnerability.vuln_id_map = {}
Vulnerability.all = {}

function Vulnerability.new(vuln_id, description)
  local self = setmetatable({}, Vulnerability)
  self.vuln_id = vuln_id
  self.description = description
  Vulnerability.all[#(Vulnerability.all)+1] = self
  Vulnerability.vuln_id_map[vuln_id] = self
  return self
end

function Vulnerability.load()
  local f = assert(io.open("data/vulns.txt", "r"))
  local t = f:read("*all")
  f:close()
  local items = t:split("======================================================\n")
  for index = 2, #items do
    local item = items[index]
    local lines = item:split("\n")
    local vuln_id = lines[1]:gsub("Name: ", "")
    table.remove(lines, 1)
    local description = table.concat(lines, "\n")
    Vulnerability.new(vuln_id, description)
  end
  return Vulnerability.all
end

function Vulnerability.lookup(vuln_id)
  return Vulnerability.vuln_id_map[vuln_id]
end

return Vulnerability