local main_menu = {}

function load_data()
  -- load read data
  loveframes.SetState("loading")
    -- clean up
  Vulnerability.vuln_id_map = {}
  Vulnerability.all = {}
  Os.os_name_version_map = {}
  Os.all = {}
  Configuration.configuration_name_map = {}
  Configuration.all = {}
  Service.service_name_version_map = {}
  Service.all = {}
    -- load data
  Vulnerability.load()
  Os.load()
  Configuration.load()
  Service.load()
    -- load mods
  local mod_dirs = love.filesystem.getDirectoryItems("mods")
  for _, mod_dir in ipairs(mod_dirs) do
    mod_path = "mods." .. mod_dir .. ".main"
    require(mod_path)
  end
end

function main_menu:load()

  local middlefont = love.graphics.newFont(24)

  local center_grid = loveframes.Create("grid")
  center_grid:SetState("main_menu")
  center_grid:SetRows(3)
  center_grid:SetColumns(1)
  center_grid:SetCellPadding(5)
  center_grid:SetItemAutoSize(true)

  local tutorial_button = loveframes.Create("button")
  tutorial_button:SetState("main_menu")
  tutorial_button:SetText("Tutorial")
  tutorial_button:SetProperty("button_text_font", middlefont)
  tutorial_button.OnClick = function(object)
    load_data()
    game:load_map("tutorial")
    loveframes.SetState("play")
    loveframes.util.SetActiveSkin("Hack_Play")
  end
  center_grid:AddItem(tutorial_button, 1, 1)

  local start_button = loveframes.Create("button")
  start_button:SetState("main_menu")
  start_button:SetText("Continue")
  local save_file = io.open("save/map.json", "r")
  if save_file then
    start_button:SetEnabled(true)
  else
    start_button:SetEnabled(false)
  end
  start_button.OnClick = function(object)
    load_data()
    game:load_map()
    loveframes.SetState("play")
    loveframes.util.SetActiveSkin("Hack_Play")
  end
  center_grid:AddItem(start_button, 2, 1)

  local quit_button = loveframes.Create("button")
  quit_button:SetState("main_menu")
  quit_button:SetText("Exit")
  quit_button.OnClick = function(object)
    love.event.push('quit')
  end
  center_grid:AddItem(quit_button, 3, 1)

  center_grid:Center()
end

return main_menu
