if Outcome == nil then
  Outcome = require "lib.Outcome"
end
if dns_resolver == nil then
  dns_resolver = require "lib.dns_resolver"
end

resolve_all_dns = Outcome.new("resolve all dns")
resolve_all_dns.eval = function (domain_name)
  return_str = ""
  answers = dns_resolver.resolve(domain_name)
  if answers == nil then
    return "Host " .. domain_name .. " not found"
  end
  for _, answer in pairs(answers) do
    return_str = return_str .. answer.type .. " record: " .. answer.value .. "\n"
  end
  return return_str
end

resolve_a_record = Outcome.new("resolve A record")
resolve_a_record.eval = function (domain_name)
  answer = dns_resolver.resolve(domain_name, "A")
  if answer == nil then
    if dns_resolver.resolve(domain_name) == nil then
      return "Host " .. domain_name .. " not found"
    else
      return domain_name .. " has no A record"
    end
  else
    return domain_name .. " has address " .. answer .. "\n"
  end
end

resolve_cname_record = Outcome.new("resolve CNAME record")
resolve_cname_record.eval = function (domain_name)
  answer = dns_resolver.resolve(domain_name, "CNAME")
  if answer == nil then
    if dns_resolver.resolve(domain_name) == nil then
      return "Host " .. domain_name .. " not found"
    else
      return domain_name .. " has no CNAME record"
    end
  else
    return domain_name .. " is an alias for " .. answer .. "\n"
  end
end

resolve_ns_record = Outcome.new("resolve NS record")
resolve_ns_record.eval = function (domain_name)
  answer = dns_resolver.resolve(domain_name, "NS")
  if answer == nil then
    if dns_resolver.resolve(domain_name) == nil then
      return "Host " .. domain_name .. " not found"
    else
      return domain_name .. " has no NS record"
    end
  else
    return domain_name .. " name server " .. answer .. "\n"
  end
end

resolve_mx_record = Outcome.new("resolve MX record")
resolve_mx_record.eval = function (domain_name)
  answer = dns_resolver.resolve(domain_name, "MX")
  if answer == nil then
    if dns_resolver.resolve(domain_name) == nil then
      return "Host " .. domain_name .. " not found"
    else
      return domain_name .. " has no MX record"
    end
  else
    return domain_name .. " mail is handled by " .. answer .. "\n"
  end
end
