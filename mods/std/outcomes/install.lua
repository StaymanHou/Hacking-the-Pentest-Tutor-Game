if Outcome == nil then
  Outcome = require "lib.Outcome"
end
if Tool == nil then
  Tool = require "lib.Tool"
end
if Virus == nil then
  Virus = require "lib.Virus"
end
if Rootkit == nil then
  Rootkit = require "lib.Rootkit"
end
if Host == nil then
  Host = require "lib.Host"
end

install_program = Outcome.new("install program")
install_program.eval = function (target_host, target_program_str)
  if target_host.state ~= Host.State.Mine and target_host.state ~= Host.State.RootAccess then
    return "You don't have the permission to install a program!"
  end
  local target_program = Tool.lookup(target_program_str)
  if target_program == nil then
    target_program = Virus.lookup(target_program_str)
  end
  if target_program == nil then
    target_program = Rootkit.lookup(target_program_str)
  end
  if target_program == nil then
    return "Unable to install the program. " .. target_program_str .. " not found."
  end
  local flag_program_installed = false
  for _,tool in ipairs(target_host.tools) do
    if tool == target_program then
      flag_program_installed = true
      break
    end
  end
  if flag_program_installed == false then
    for _,virus in ipairs(target_host.viruses) do
      if virus == target_program then
        flag_program_installed = true
        break
      end
    end
  end
  if flag_program_installed == false then
    for _,rootkit in ipairs(target_host.rootkits) do
      if rootkit == target_program then
        flag_program_installed = true
        break
      end
    end
  end
  if flag_program_installed then
    return target_program_str .. " is already installed."
  end
  target_host:install(target_program)
  if target_program.__index == Tool then
    game.play.elements.tools_multichoice:AddChoice(target_program.name)
  end
  return target_program_str .. " is newly installed."
end
